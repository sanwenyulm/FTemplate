(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-082826ac"],{"3c34":function(e,t,n){"use strict";n.r(t);var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"app-container"},[n("aside",[e._v("\n    "+e._s(e.device.name)+"-"+e._s(e.device.snNumber)+"的传感器：\n  ")]),e._v(" "),n("el-button",{attrs:{type:"primary"},on:{click:e.handleAddRole}},[e._v("\n    添加传感器\n  ")]),e._v(" "),n("el-button",{attrs:{type:"primary"},on:{click:e.handleRefresh}},[e._v("\n    刷新传感器\n  ")]),e._v(" "),n("el-button",{attrs:{type:"primary"},on:{click:e.handleRefeshAllSensorData}},[e._v("\n    拉取传感器当前值\n  ")]),e._v(" "),n("el-table",{staticStyle:{width:"100%","margin-top":"30px"},attrs:{data:e.sensorList,border:""}},[n("el-table-column",{attrs:{align:"center",label:"传感器名称",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n              "+e._s(t.row.name)+"\n            ")]}}])}),e._v(" "),n("el-table-column",{attrs:{align:"center",label:"序列号",width:"110"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n              "+e._s(t.row.sensorsn)+"\n            ")]}}])}),e._v(" "),n("el-table-column",{attrs:{align:"header-center",label:"状态"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n              "+e._s(t.row.status)+"\n            ")]}}])}),e._v(" "),n("el-table-column",{attrs:{align:"header-center",label:"类型"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n              "+e._s(1==t.row.type?"开关型":"数值型")+"\n            ")]}}])}),e._v(" "),n("el-table-column",{attrs:{align:"header-center",label:"值"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n              "+e._s(t.row.value)+"\n            ")]}}])}),e._v(" "),n("el-table-column",{attrs:{align:"header-center",label:"单位"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n              "+e._s(t.row.unit)+"\n            ")]}}])}),e._v(" "),n("el-table-column",{attrs:{align:"center",label:"开关操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[1==t.row.type?n("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"#ff4949","active-value":"true","inactive-value":"false"},on:{change:function(n){return e.handleSwitch(t)}},model:{value:t.row.value,callback:function(n){e.$set(t.row,"value",n)},expression:"scope.row.value"}}):e._e(),e._v(" "),2==t.row.type?n("el-input",{attrs:{placeholder:"请输入值"},model:{value:t.row.value,callback:function(n){e.$set(t.row,"value",n)},expression:"scope.row.value"}},[n("el-button",{attrs:{slot:"append",icon:"el-icon-edit"},on:{click:function(n){return e.handleSwitch(t)}},slot:"append"})],1):e._e()]}}])}),e._v(" "),n("el-table-column",{attrs:{align:"center",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(n){return e.handleEdit(t)}}},[e._v("\n                编辑\n              ")]),e._v(" "),n("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(n){return e.handleCurrentData(t)}}},[e._v("\n                拉取数据\n              ")]),e._v(" "),n("el-button",{attrs:{type:"danger",size:"small"},on:{click:function(n){return e.handleDelete(t)}}},[e._v("\n                删除\n              ")]),e._v(" "),n("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(n){return e.handleCheckDatas(t)}}},[e._v("\n                数据记录\n              ")])]}}])})],1),e._v(" "),n("el-dialog",{attrs:{visible:e.dialogVisible,title:"edit"===e.dialogType?"编辑传感器":"新建传感器"},on:{"update:visible":function(t){e.dialogVisible=t}}},[n("el-form",{attrs:{model:e.sensor,"label-width":"80px","label-position":"left"}},[n("el-form-item",{attrs:{label:"名称"}},[n("el-input",{attrs:{placeholder:"传感器名称"},model:{value:e.sensor.name,callback:function(t){e.$set(e.sensor,"name",t)},expression:"sensor.name"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"从机地址"}},[n("el-input",{attrs:{placeholder:"从机地址"},model:{value:e.sensor.deviceAddr,callback:function(t){e.$set(e.sensor,"deviceAddr",t)},expression:"sensor.deviceAddr"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"地址"}},[n("el-input",{attrs:{placeholder:"偏移地址"},model:{value:e.sensor.deviceOffset,callback:function(t){e.$set(e.sensor,"deviceOffset",t)},expression:"sensor.deviceOffset"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"操作类型"}},[n("el-select",{attrs:{placeholder:"操作类型"},model:{value:e.sensor.funcode,callback:function(t){e.$set(e.sensor,"funcode",t)},expression:"sensor.funcode"}},[n("el-option",{attrs:{label:"读开关状态",value:"1"}}),e._v(" "),n("el-option",{attrs:{label:"改变开关状态",value:"5"}}),e._v(" "),n("el-option",{attrs:{label:"读数值",value:"3"}}),e._v(" "),n("el-option",{attrs:{label:"写数值",value:"6"}})],1)],1),e._v(" "),n("el-form-item",{attrs:{label:"数值类型"}},[n("el-select",{attrs:{placeholder:"数值类型"},model:{value:e.sensor.type,callback:function(t){e.$set(e.sensor,"type",t)},expression:"sensor.type"}},[n("el-option",{attrs:{label:"开关型",value:"1"}}),e._v(" "),n("el-option",{attrs:{label:"数值型",value:"2"}})],1)],1),e._v(" "),n("el-form-item",{attrs:{label:"数值"}},[n("el-input",{attrs:{placeholder:"数值"},model:{value:e.sensor.value,callback:function(t){e.$set(e.sensor,"value",t)},expression:"sensor.value"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"单位"}},[n("el-input",{attrs:{placeholder:"单位"},model:{value:e.sensor.unit,callback:function(t){e.$set(e.sensor,"unit",t)},expression:"sensor.unit"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"描述"}},[n("el-input",{attrs:{autosize:{minRows:2,maxRows:4},type:"textarea",placeholder:"Role Description"},model:{value:e.sensor.mark,callback:function(t){e.$set(e.sensor,"mark",t)},expression:"sensor.mark"}})],1)],1),e._v(" "),n("div",{staticStyle:{"text-align":"right"}},[n("el-button",{attrs:{type:"danger"},on:{click:function(t){e.dialogVisible=!1}}},[e._v("\n        "+e._s(e.$t("permission.cancel"))+"\n      ")]),e._v(" "),n("el-button",{attrs:{type:"primary"},on:{click:e.confirmRole}},[e._v("\n        "+e._s(e.$t("permission.confirm"))+"\n      ")])],1)],1)],1)},s=[],a=n("cebc"),i=(n("6762"),n("2fdb"),n("75fc")),o=(n("ac4d"),n("8a81"),n("ac6a"),n("96cf"),n("3b8d")),l=n("df7c"),c=n.n(l),u=(n("ed08"),n("b775"));function d(e,t){return Object(u["a"])({url:"/sensor/all",method:"get",params:{deviceId:e,page:t}})}function h(e){return Object(u["a"])({url:"/sensor/operate",method:"post",data:e})}function f(e){return Object(u["a"])({url:"/sensor/addSensor",method:"post",data:e})}function v(e){return Object(u["a"])({url:"/sensor/updateSensor",method:"post",data:e})}function p(e){return Object(u["a"])({url:"/sensor/deleteSensor",method:"get",params:{sensorId:e}})}function m(e,t){return Object(u["a"])({url:"/sensor/getSensorDatas",method:"get",params:{sensorId:e,page:t}})}function b(e,t){return Object(u["a"])({url:"/sensor/refreshAllSensorDatas",method:"get",params:{deviceId:e,deviceSn:t}})}function g(e){return Object(u["a"])({url:"/sensor/refreshOneSensorData",method:"get",params:{sensorId:e}})}var y={key:"",name:"",description:"",routes:[]},w={data:function(){return{device:{},switchStatus:!1,sensor:{deviceid:1,id:0,name:"",addr:"",sensorsn:"",deviceAddr:0,deviceOffset:0,funcode:"",type:"",value:"",unit:"",mark:"",status:""},routes:[],sensorList:[],sensorDataList:[],deviceList:[],dialogVisible:!1,dialogType:"new",checkStrictly:!1,defaultProps:{children:"children",label:"title"},result:"null"}},computed:{routesData:function(){return this.routes}},created:function(){this.device=this.$route.query.device,this.sensor.deviceid=this.device.id,this.getSensors(this.device.id,0)},methods:{handleCurrentData:function(e){this.refreshOneSensorData(e.row.id)},handleRefeshAllSensorData:function(){this.refreshAllSensorDatas(this.device.id,this.device.snNumber)},handleCheckDatas:function(e){this.getSensorDatas(e.row.id,0)},handleRefresh:function(){this.getSensors(this.device.id,0)},handleSwitch:function(e){var t=new Object;t.deviceSn=this.device.snNumber,t.deviceId=this.device.id,t.isCoil=1==e.row.type,t.isOpen="true"==e.row.value,t.sensorId=e.row.id,t.value=e.row.value;var n=this;new Promise(function(e,r){h(t).then(function(t){n.$message({type:"error",message:t}),e()}).catch(function(e){r(e)})})},refreshOneSensorData:function(){var e=Object(o["a"])(regeneratorRuntime.mark(function e(t){var n,r;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,g(t);case 2:n=e.sent,r=/\d/,r.test(n)?this.sensor.value=n:this.$message({type:"success",message:n});case 5:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}(),refreshAllSensorDatas:function(){var e=Object(o["a"])(regeneratorRuntime.mark(function e(t,n){var r;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,b(t,n);case 2:r=e.sent,this.result=r,this.$message({type:"success",message:r});case 5:case"end":return e.stop()}},e,this)}));function t(t,n){return e.apply(this,arguments)}return t}(),getSensors:function(){var e=Object(o["a"])(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,d(t,0);case 2:n=e.sent,this.sensorList=n;case 4:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}(),getSensorDatas:function(){var e=Object(o["a"])(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,m(t,0);case 2:n=e.sent,this.sensorDataList=n;case 4:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}(),generateRoutes:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"/",n=[],r=!0,s=!1,a=void 0;try{for(var i,o=e[Symbol.iterator]();!(r=(i=o.next()).done);r=!0){var l=i.value;if(!l.hidden){var u=this.onlyOneShowingChild(l.children,l);l.children&&u&&!l.alwaysShow&&(l=u);var d={path:c.a.resolve(t,l.path),title:l.meta&&l.meta.title};l.children&&(d.children=this.generateRoutes(l.children,d.path)),n.push(d)}}}catch(h){s=!0,a=h}finally{try{r||null==o.return||o.return()}finally{if(s)throw a}}return n},generateArr:function(e){var t=this,n=[];return e.forEach(function(e){if(n.push(e),e.children){var r=t.generateArr(e.children);r.length>0&&(n=[].concat(Object(i["a"])(n),Object(i["a"])(r)))}}),n},handleAddRole:function(){this.role=Object.assign({},y),this.$refs.tree&&this.$refs.tree.setCheckedNodes([]),this.dialogType="new",this.dialogVisible=!0},handleEdit:function(e){this.dialogType="edit",this.dialogVisible=!0,this.checkStrictly=!0,this.sensor=e.row},handleDelete:function(e){var t=this,n=e.$index,r=e.row;this.$confirm("删除此传感器?","Warning",{confirmButtonText:"删除",cancelButtonText:"取消",type:"warning"}).then(Object(o["a"])(regeneratorRuntime.mark(function e(){var s;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,p(r.id);case 2:s=e.sent,s?(t.sensorList.splice(n,1),t.$message({type:"success",message:"删除成功!"})):t.$message({type:"success",message:"删除失败!"});case 4:case"end":return e.stop()}},e)}))).catch(function(e){console.error(e)})},generateTree:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"/",n=arguments.length>2?arguments[2]:void 0,r=[],s=!0,a=!1,i=void 0;try{for(var o,l=e[Symbol.iterator]();!(s=(o=l.next()).done);s=!0){var u=o.value,d=c.a.resolve(t,u.path);u.children&&(u.children=this.generateTree(u.children,d,n)),(n.includes(d)||u.children&&u.children.length>=1)&&r.push(u)}}catch(h){a=!0,i=h}finally{try{s||null==l.return||l.return()}finally{if(a)throw i}}return r},confirmRole:function(){var e=Object(o["a"])(regeneratorRuntime.mark(function e(){var t,n,r;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(t="edit"===this.dialogType,!t){e.next=8;break}return e.next=4,v(this.sensor);case 4:n=e.sent,n?this.$message({type:"success",message:"更新成功!"}):this.$message({type:"success",message:"更新失败!"}),e.next=14;break;case 8:return this.sensor.id=0,e.next=11,f(this.sensor);case 11:r=e.sent,this.sensor.id=r,this.sensorList.push(this.sensor);case 14:this.dialogVisible=!1;case 15:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),onlyOneShowingChild:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0,n=null,r=e.filter(function(e){return!e.hidden});return 1===r.length?(n=r[0],n.path=c.a.resolve(t.path,n.path),n):0===r.length&&(n=Object(a["a"])({},t,{path:"",noShowingChildren:!0}),n)}}},_=w,k=(n("9139"),n("2877")),S=Object(k["a"])(_,r,s,!1,null,"6f3b84ea",null);t["default"]=S.exports},"4bdf":function(e,t,n){},9139:function(e,t,n){"use strict";var r=n("4bdf"),s=n.n(r);s.a}}]);